Version 4
SHEET 1 4100 1852
WIRE 3616 -208 3552 -208
WIRE 3616 -144 3616 -208
WIRE 544 -64 512 -64
WIRE 3616 -16 3616 -64
WIRE 3616 -16 3472 -16
WIRE 3904 0 3840 0
WIRE 416 32 368 32
WIRE 2416 32 2368 32
WIRE 2512 32 2416 32
WIRE 2800 32 2736 32
WIRE 3472 32 3472 -16
WIRE 1568 48 1504 48
WIRE 416 80 416 32
WIRE 3184 80 3072 80
WIRE 3264 80 3184 80
WIRE 3408 80 3264 80
WIRE 2416 96 2416 32
WIRE 2512 96 2512 32
WIRE 2800 112 2800 32
WIRE 3904 112 3904 0
WIRE 544 160 544 -64
WIRE 3184 160 3184 80
WIRE 3264 160 3264 80
WIRE 3616 160 3616 -16
WIRE 3696 160 3616 160
WIRE 3840 160 3696 160
WIRE 3472 176 3472 128
WIRE -16 208 -160 208
WIRE 48 208 -16 208
WIRE 112 208 48 208
WIRE 240 208 176 208
WIRE 416 208 416 160
WIRE 416 208 320 208
WIRE 480 208 416 208
WIRE 1568 208 1568 48
WIRE 2416 224 2416 176
WIRE 2512 224 2512 160
WIRE 2512 224 2416 224
WIRE 2800 224 2800 192
WIRE 2944 224 2800 224
WIRE 3072 224 3072 80
WIRE 3072 224 3008 224
WIRE 2800 256 2800 224
WIRE -160 272 -160 208
WIRE 48 272 48 208
WIRE 544 272 544 256
WIRE 640 272 544 272
WIRE 800 272 704 272
WIRE 960 272 800 272
WIRE 1072 272 960 272
WIRE 1312 272 1072 272
WIRE 1488 272 1312 272
WIRE 3184 272 3184 224
WIRE 3264 272 3264 240
WIRE 3264 272 3184 272
WIRE 544 288 544 272
WIRE 3616 288 3616 160
WIRE 3616 288 3472 288
WIRE 1856 304 1648 304
WIRE 2416 304 2416 224
WIRE 2416 304 1856 304
WIRE 2640 304 2416 304
WIRE 2736 304 2640 304
WIRE 3264 304 3264 272
WIRE 960 336 960 272
WIRE 1072 336 1072 272
WIRE 1488 336 1440 336
WIRE 3472 336 3472 288
WIRE 3616 336 3616 288
WIRE 2800 384 2800 352
WIRE 2896 384 2800 384
WIRE 2944 384 2896 384
WIRE 3072 384 2944 384
WIRE 3184 384 3136 384
WIRE 3264 384 3184 384
WIRE 3408 384 3264 384
WIRE 3904 400 3904 208
WIRE -160 416 -160 352
WIRE 48 416 48 352
WIRE 544 416 544 368
WIRE 2800 416 2800 384
WIRE 1072 448 1072 416
WIRE 1136 448 1072 448
WIRE 1280 448 1216 448
WIRE 1568 448 1568 384
WIRE 960 464 960 416
WIRE 3184 464 3184 384
WIRE 3264 464 3264 384
WIRE 1072 480 1072 448
WIRE 3472 480 3472 432
WIRE 3616 480 3616 400
WIRE 1616 496 1616 384
WIRE 1728 496 1616 496
WIRE 1872 496 1728 496
WIRE 2000 496 1952 496
WIRE 2800 544 2800 496
WIRE 3184 576 3184 528
WIRE 3264 576 3264 544
WIRE 3264 576 3184 576
WIRE 1072 592 1072 560
WIRE 1328 592 1072 592
WIRE 1440 592 1440 336
WIRE 1440 592 1328 592
WIRE 3264 608 3264 576
WIRE 1072 640 1072 592
WIRE 1440 640 1440 592
WIRE 1440 640 1344 640
WIRE 0 656 -144 656
WIRE 112 656 0 656
WIRE 256 656 112 656
WIRE 112 688 112 656
WIRE 3904 688 3904 480
WIRE 3904 688 3712 688
WIRE 1344 704 1344 640
WIRE 1440 704 1440 640
WIRE 0 768 0 656
WIRE 1072 768 1072 720
WIRE -144 784 -144 656
WIRE 112 800 112 768
WIRE 192 800 112 800
WIRE 256 800 192 800
WIRE 1344 816 1344 768
WIRE 1440 816 1440 784
WIRE 1440 816 1344 816
WIRE 112 832 112 800
WIRE 192 848 192 800
WIRE 1440 864 1440 816
WIRE 2896 880 2896 384
WIRE 3008 880 2896 880
WIRE 3200 880 3008 880
WIRE 3328 880 3264 880
WIRE 3472 880 3408 880
WIRE -144 944 -144 864
WIRE 0 944 0 832
WIRE 0 944 -144 944
WIRE 112 944 112 912
WIRE 112 944 0 944
WIRE 192 944 192 912
WIRE 192 944 112 944
WIRE 3472 944 3472 880
WIRE 112 976 112 944
WIRE 1440 976 1440 928
WIRE 3472 1056 3472 1024
WIRE 3808 1056 3472 1056
WIRE 3472 1088 3472 1056
WIRE 3472 1200 3472 1168
FLAG 112 976 0
FLAG 256 800 V3P0
FLAG 256 656 V9P0
FLAG 544 416 0
FLAG 48 416 0
FLAG 368 32 V3P0
FLAG -160 416 0
FLAG 512 -64 V9P0
FLAG 960 464 0
FLAG 1072 768 0
FLAG 1328 592 V_nInv_OTA
FLAG 1312 272 V_Inv_OTA
FLAG 1280 448 V9P0
FLAG 1440 976 0
FLAG 1856 304 V_OTA_Out
FLAG 2368 32 V3P0
FLAG 2800 544 0
FLAG 2736 32 V9P0
FLAG 3264 304 0
FLAG 3264 608 0
FLAG 3472 480 0
FLAG 3552 -208 V9P0
FLAG 3472 176 0
FLAG 3616 480 0
FLAG 3472 1200 0
FLAG 3808 1056 Vout
FLAG 2000 496 V_OTA_Ifeedback
FLAG 3840 0 V9P0
FLAG 1504 48 V9P0
FLAG 3712 688 V_OTA_Ifeedback
FLAG 1568 448 0
FLAG 2640 304 V_OTA_Out
FLAG 800 272 V_Inv_OTA
FLAG 3008 880 V_comp_out
FLAG 2944 384 V_comp_out
FLAG 3264 80 V_env_det_comp
FLAG 3264 384 V_env_det
FLAG 3696 160 V_env_level
FLAG -16 208 V_in
FLAG 1728 496 V_OTA_GainSet
SYMBOL voltage -144 768 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 9
SYMBOL res 96 672 R0
SYMATTR InstName R1
SYMATTR Value 56k
SYMBOL res 96 816 R0
SYMATTR InstName R2
SYMATTR Value 27k
SYMBOL cap 176 848 R0
SYMATTR InstName C1
SYMATTR Value 1µF
SYMBOL res 32 256 R0
SYMATTR InstName R3
SYMATTR Value 4.7Meg
SYMBOL cap 176 192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10nF
SYMBOL res 336 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL res 432 176 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R5
SYMATTR Value 1Meg
SYMBOL npn 480 160 R0
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL res 528 272 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL voltage -160 256 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value SINE(0 0.1 1k)
SYMBOL cap 704 256 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 1µ
SYMBOL res 944 432 M180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 1Meg
SYMBOL res 1088 736 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R8
SYMATTR Value 1Meg
SYMBOL res 1056 320 R0
WINDOW 0 42 10 Left 2
WINDOW 3 44 41 Left 2
SYMATTR InstName R9
SYMATTR Value {2k - Rtrim + 1}
SYMBOL res 1056 464 R0
WINDOW 0 51 68 Left 2
WINDOW 3 43 97 Left 2
SYMATTR InstName R10
SYMATTR Value {Rtrim + 1}
SYMBOL res 1120 432 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 470k
SYMBOL res 1424 688 R0
SYMATTR InstName R12
SYMATTR Value 15k
SYMBOL cap 1328 704 R0
SYMATTR InstName C4
SYMATTR Value 10nF
SYMBOL cap 1424 864 R0
SYMATTR InstName C5
SYMATTR Value 1µF
SYMBOL res 2400 80 R0
SYMATTR InstName R13
SYMATTR Value 150k
SYMBOL cap 2496 96 R0
SYMATTR InstName C6
SYMATTR Value 1nF
SYMBOL npn 2736 256 R0
SYMATTR InstName Q2
SYMATTR Value 2N3904
SYMBOL res 2784 400 R0
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL res 2784 96 R0
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL cap 3008 208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C7
SYMATTR Value 10nF
SYMBOL cap 3136 368 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 10nF
SYMBOL diode 3200 224 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL res 3248 144 R0
SYMATTR InstName R16
SYMATTR Value 1Meg
SYMBOL diode 3200 528 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL res 3248 448 R0
SYMATTR InstName R17
SYMATTR Value 1Meg
SYMBOL npn 3408 32 R0
SYMATTR InstName Q3
SYMATTR Value 2N3904
SYMBOL npn 3408 336 R0
SYMATTR InstName Q4
SYMATTR Value 2N3904
SYMBOL res 3600 -160 R0
SYMATTR InstName R18
SYMATTR Value 150k
SYMBOL cap 3600 336 R0
SYMATTR InstName C9
SYMATTR Value 10µ
SYMBOL cap 3264 864 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C10
SYMATTR Value 50nF
SYMBOL npn 3840 112 R0
SYMATTR InstName Q5
SYMATTR Value 2N3904
SYMBOL res 3888 384 R0
SYMATTR InstName R19
SYMATTR Value {Rsensitivity}
SYMBOL res 3424 864 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL res 3456 928 R0
SYMATTR InstName R21
SYMATTR Value {50k - Routput + 1}
SYMBOL res 3456 1072 R0
SYMATTR InstName R22
SYMATTR Value {Routput + 1}
SYMBOL res 1856 480 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 27k
SYMBOL cap -16 768 R0
SYMATTR InstName C11
SYMATTR Value 10µF
SYMBOL AutoGenerated\\LM13700_NS 1600 304 R0
WINDOW 0 3 -127 Bottom 2
WINDOW 3 64 -125 Top 2
SYMATTR InstName U1
TEXT 1632 584 Left 2 ;LM13700 Pinout\n \n1: Amplifier Bias Input\n2: Diode Bias\n3: Positive (Noninverting) Input\n4: Negative (Inverting) Input\n5: Output\n6: Negative power supply\n7: Buffer Input\n8: Buffer Output\n11: Positive power supply
TEXT 1656 -64 Left 2 ;Note: Pins 7/8 of LM13700 are an unused \nDarlington pair listed on the datasheet as \nan on-die buffer driver.\n \nUnused in this application - but could probably \nbe incorporated into the compressor with some \nclever design.
TEXT 1000 1216 Left 2 ;NOTE: There are simulations available for sensitivity, trim pot, and level.\n \nYou can select which simulation to run by selecting this text box, copying \nthe sim statement from this note, and pasting it into the sim directive below. (The sim \ndirective is the black text below - it's labeled "PARAM SWEEP".)\n \nSENSITIVITY SIM:\n.step param Rsensitivity list 100 200 500 1k 2k 5k 10k 20k 50k 100k 200k 500k\n \nLEVEL SIM:\n.step param Rvolume list 10 20 50 100 200 500 1k 2k 5k 10k\n \nOUTPUT SIM:\n.step param Routput list 10 20 50 100 200 500 1k 2k 5k 10k 20k 50k
TEXT 16 1208 Left 2 ;NOTE: Use the following commands to switch \nbetween time and frequency domain sims.\n \nTIME DOMAIN SIM:\nV2 Value: \nSINE(0 0.1 1k)\nSPICE Command: \n.tran 0 10m 0 1u\n \nFREQUENCY DOMAIN SIM:\nV2 Value: \nAC 1\nSPICE Command:\n.ac oct 10 20 22k
TEXT 504 1640 Left 2 ;.step param R_100Hz 1 10k 1k
TEXT 440 1712 Left 2 !.tran 0 10m 0 1u
TEXT 16 1704 Left 5 ;SPICE Cmd =>
TEXT 16 1632 Left 5 ;Param Sweep =>
TEXT 992 1136 Left 6 ;Simulation Sweeps
TEXT 16 1136 Left 6 ;Operating Instructions
TEXT -144 584 Left 5 ;Power
TEXT -152 8 Left 5 ;Input Stage
TEXT 960 -40 Left 5 ;Transconductance Amp
TEXT 960 24 Left 2 !.param Rtrim=1k
TEXT 2720 -96 Left 2 !.param Rsensitivity=10k
TEXT 968 80 Left 2 ;Note: R9/R10 are 2k linear trim \npotentiometer
TEXT 2720 -152 Left 5 ;Envelope Detector
TEXT 2896 1064 Left 2 !.param Routput=50k
TEXT 2824 1000 Left 5 ;Output Stage
TEXT 1688 384 Left 2 ;NOTE: V_OTA_GainSet = ~1.3[V]\nSet by LM13700 current mirror
LINE Normal 912 992 912 -208 2
LINE Normal 2240 1008 2240 -208 2
LINE Normal 2272 784 4096 784 2
LINE Normal -192 512 896 512 2
LINE Normal -192 1008 2224 1008 2
